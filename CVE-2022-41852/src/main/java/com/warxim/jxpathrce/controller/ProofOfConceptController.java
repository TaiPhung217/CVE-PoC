package com.warxim.jxpathrce.controller;

import lombok.Value;
import org.apache.commons.jxpath.FunctionLibrary;
import org.apache.commons.jxpath.JXPathContext;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;


@RestController
public class ProofOfConceptController {

    @Value
    public static class Person {
        String name;
        String website;
    }

    private final Person person = new Person( "Phan The Anh", "theanh.blog.com");

    @GetMapping("endpoint1")
    public Object getVulnerableExample(
            @RequestParam(defaultValue = "/") String path
    ) {
        var pathContext = JXPathContext.newContext(person);

        return pathContext.getValue(path);
    }

    @GetMapping("endpoint2")
    public Object getSecureExample(
            @RequestParam(defaultValue = "/") String path
    ) {
        var pathContext = JXPathContext.newContext(person);

        pathContext.setFunctions(new FunctionLibrary());
        return pathContext.getValue(path);
    }

}
